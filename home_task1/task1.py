import queue
import time
import uuid # –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö ID –∑–∞—è–≤–æ–∫
import random # –î–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó —Ä—ñ–∑–Ω–æ–≥–æ —á–∞—Å—É –æ–±—Ä–æ–±–∫–∏ —Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó

# –°—Ç–≤–æ—Ä—é—î–º–æ —á–µ—Ä–≥—É –∑–∞—è–≤–æ–∫
request_queue = queue.Queue()
request_counter = 0 # –õ—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö ID, —è–∫—â–æ uuid –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω

def generate_request():   
    global request_counter
    request_counter += 1
    # –°—Ç–≤–æ—Ä—é—î–º–æ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –¥–ª—è –∑–∞—è–≤–∫–∏
    request_id = uuid.uuid4()      
    # –Ü–º—ñ—Ç—É—î–º–æ –¥–µ—è–∫—ñ –¥–∞–Ω—ñ –∑–∞—è–≤–∫–∏
    request_data = {
        "id": str(request_id),
        "type": random.choice(["–¢–µ—Ö–Ω—ñ—á–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞", "–ó–∞–ø–∏—Ç –Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é", "–°–∫–∞—Ä–≥–∞"]),
        "priority": random.choice(["–í–∏—Å–æ–∫–∏–π", "–°–µ—Ä–µ–¥–Ω—ñ–π", "–ù–∏–∑—å–∫–∏–π"])
    }    
    request_queue.put(request_data)
    print(f"‚û°Ô∏è  –ù–æ–≤–∞ –∑–∞—è–≤–∫–∞ –¥–æ–¥–∞–Ω–∞: {request_data['id']} (–¢–∏–ø: {request_data['type']}, –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç: {request_data['priority']}). –ß–µ—Ä–≥–∞: {request_queue.qsize()} –∑–∞—è–≤–æ–∫.")

def process_request():    
    if not request_queue.empty():
        current_request = request_queue.get()
        print(f"‚è≥ –û–±—Ä–æ–±–∫–∞ –∑–∞—è–≤–∫–∏: {current_request['id']}...")
        # –Ü–º—ñ—Ç–∞—Ü—ñ—è —á–∞—Å—É –Ω–∞ –æ–±—Ä–æ–±–∫—É –∑–∞—è–≤–∫–∏
        processing_time = random.uniform(0.5, 2.0) # –í–∏–ø–∞–¥–∫–æ–≤–∏–π —á–∞—Å –≤—ñ–¥ 0.5 –¥–æ 2 —Å–µ–∫—É–Ω–¥
        time.sleep(processing_time)
        print(f"‚úÖ –ó–∞—è–≤–∫–∞ {current_request['id']} –æ–±—Ä–æ–±–ª–µ–Ω–∞ –∑–∞ {processing_time:.2f} —Å–µ–∫. –ó–∞–ª–∏—à–∏–ª–æ—Å—å –≤ —á–µ—Ä–∑—ñ: {request_queue.qsize()} –∑–∞—è–≤–æ–∫.")
        request_queue.task_done() # –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ —á–µ—Ä–∑—ñ, —â–æ –∑–∞–¥–∞—á–∞ –≤–∏–∫–æ–Ω–∞–Ω–∞ (–≤–∞–∂–ª–∏–≤–æ –¥–ª—è –¥–µ—è–∫–∏—Ö —Ç–∏–ø—ñ–≤ —á–µ—Ä–≥)
    else:
        print("–ß–µ—Ä–≥–∞ –∑–∞—è–≤–æ–∫ –ø—É—Å—Ç–∞. –ù–µ–º–∞—î —á–æ–≥–æ –æ–±—Ä–æ–±–ª—è—Ç–∏.")

# –ì–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –ø—Ä–æ–≥—Ä–∞–º–∏
if __name__ == "__main__":
    print("üöÄ –°–∏–º—É–ª—è—Ç–æ—Ä —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É –∑–∞–ø—É—â–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å CTRL+C –¥–ª—è –≤–∏—Ö–æ–¥—É.")
    try:
        while True:
            # –Ü–º—ñ—Ç–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫–æ–≤–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–∞—è–≤–æ–∫
            if random.random() < 0.7: # –ó –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é 70% –≥–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤—É –∑–∞—è–≤–∫—É
                generate_request()            
            # –Ü–º—ñ—Ç–∞—Ü—ñ—è –æ–±—Ä–æ–±–∫–∏ –∑–∞—è–≤–æ–∫
            if random.random() < 0.5 or not request_queue.empty(): # –ó –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—é 50% –∞–±–æ —è–∫—â–æ —á–µ—Ä–≥–∞ –Ω–µ –ø—É—Å—Ç–∞
                process_request()            
            # –ù–µ–≤–µ–ª–∏–∫–∞ –∑–∞—Ç—Ä–∏–º–∫–∞, —â–æ–± –Ω–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤–∏–≤—ñ–¥ —ñ –ø—Ä–æ—Ü–µ—Å–æ—Ä
            time.sleep(random.uniform(0.1, 0.5))             
    except KeyboardInterrupt:
        print("\nüõë –°–∏–º—É–ª—è—Ç–æ—Ä —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä—É –∑—É–ø–∏–Ω–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º.")
    finally:
        # –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–¥–∞—á —É —á–µ—Ä–∑—ñ –ø–µ—Ä–µ–¥ –≤–∏—Ö–æ–¥–æ–º (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
        # request_queue.join() # –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ, —è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ task_done() —ñ —Ö–æ—á–µ—Ç–µ –¥–æ—á–µ–∫–∞—Ç–∏—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤—Å—ñ—Ö –∑–∞–¥–∞—á
        print("üö™ –ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")